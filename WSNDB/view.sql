-- Province
CREATE VIEW `provincedistrict` AS select `r`.`RegionNo` AS `RegionNo`,`p`.`ProvinceNo` AS `ProvinceNo`,`d`.`DistrictNo` AS `DistrictNo`,`s`.`SubDistrictNo` AS `SubDistrictNo`,`r`.`RegionName` AS `RegionName`,`p`.`ThaiName` AS `ProvinceThai`,`p`.`EngName` AS `ProvinceEng`,`d`.`ThaiName` AS `DistrictThai`,`d`.`EngName` AS `DistrictEng`,`s`.`ThaiName` AS `SubDistrictThai`,`s`.`EngName` AS `SubDistrictEng`,`s`.`PostCode` AS `PostCode` from (((`province` `p` left join `region` `r` on((`p`.`RegionNo` = `r`.`RegionNo`))) left join `district` `d` on(((`d`.`RegionNo` = `p`.`RegionNo`) and (`d`.`ProvinceNo` = `p`.`ProvinceNo`)))) left join `subdistrict` `s` on(((`s`.`RegionNo` = `d`.`RegionNo`) and (`s`.`ProvinceNo` = `d`.`ProvinceNo`) and (`s`.`DistrictNo` = `d`.`DistrictNo`))));


drop view r101;
drop view r101_1;
drop view r102;
drop view r102_1;
drop view r103;
drop view r103_1;
drop view r104;
drop view r104_1;
drop view r104_2;
drop view r104_3;
drop view r105;
drop view r105_1;
drop view r106;
drop view r107;
drop view r108_1;
drop view r109_1;
drop view r110;
drop view r110_1;


CREATE VIEW `r101` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`p`.`CustomerNo` AS `customerNo`,`bt`.`BreedTypeName` AS `breedTypeName`,`l`.`PlantDate` AS `plantDate`,`l`.`ForecastDate` AS `forecastDate`,`l`.`PlantRai` AS `plantRai`,`l`.`PlantNgan` AS `plantNgan`,`l`.`PlantWah` AS `plantWah`,`l`.`ForecastRecord` AS `forecastRecord`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`b`.`ProvinceNo` AS `provinceNo`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from (((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedtype` `bt` on((`d`.`BreedTypeId` = `bt`.`BreedTypeId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d')))
;


CREATE VIEW `r101_1` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`p`.`CustomerNo` AS `customerNo`,`g`.`BreedGroupName` AS `breedGroupName`,`l`.`PlantDate` AS `plantDate`,`l`.`ForecastDate` AS `forecastDate`,`l`.`PlantRai` AS `plantRai`,`l`.`PlantNgan` AS `plantNgan`,`l`.`PlantWah` AS `plantWah`,`l`.`ForecastRecord` AS `forecastRecord`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`b`.`ProvinceNo` AS `provinceNo`,`d`.`BreedTypeId` AS `breedTypeId`,`d`.`BreedGroupId` AS `breedGroupId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `farmergroup` `fg` on((`p`.`FarmerGroupId` = `fg`.`FarmerGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d')))
;



CREATE VIEW `r102` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`bt`.`BreedTypeName` AS `breedTypeName`,`p`.`IdCard` AS `countFarmer`,sum(`l`.`PlantRai`) AS `plantRai`,sum(`l`.`PlantNgan`) AS `plantNgan`,sum(`l`.`PlantWah`) AS `plantWah`,sum(`l`.`ForecastRecord`) AS `forecastRecord`,`pro`.`ThaiName` AS `provinceName`,`p`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`b`.`ProvinceNo` AS `provinceNo`,`d`.`BreedTypeId` AS `BreedTypeId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedtype` `bt` on((`d`.`BreedTypeId` = `bt`.`BreedTypeId`))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d'))) group by `p`.`PlantId`,`l`.`ProvinceNo`,`l`.`SubDistrictNo`
;


CREATE VIEW `r102_1` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`bt`.`BreedTypeName` AS `breedTypeName`,`bg`.`BreedGroupName` AS `breedGroupName`,`p`.`IdCard` AS `countFarmer`,sum(`l`.`PlantRai`) AS `plantRai`,sum(`l`.`PlantNgan`) AS `plantNgan`,sum(`l`.`PlantWah`) AS `plantWah`,sum(`l`.`ForecastRecord`) AS `forecastRecord`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`b`.`ProvinceNo` AS `provinceNo`,`p`.`BreedTypeId` AS `BreedTypeId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from (((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedtype` `bt` on((`d`.`BreedTypeId` = `bt`.`BreedTypeId`))) left join `breedgroup` `bg` on((`d`.`BreedGroupId` = `bg`.`BreedGroupId`))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d'))) group by `p`.`PlantId`,`l`.`ProvinceNo`,`l`.`SubDistrictNo`,`bg`.`BreedGroupId`
;



CREATE VIEW `r103` AS select `b`.`BranchName` AS `branchName`,`l`.`ForecastDate` AS `forecastDate`,`g`.`BreedGroupName` AS `breedGroupName`,`fg`.`FarmerGroupName` AS `farmerGroupName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`l`.`PlantDate` AS `plantDate`,`l`.`PlantRai` AS `plantRai`,`l`.`PlantNgan` AS `plantNgan`,`l`.`PlantWah` AS `plantWah`,`l`.`ForecastRecord` AS `forecastRecord`,`pro`.`ThaiName` AS `provinceName`,`l`.`ProvinceNo` AS `provinceNo`,`b`.`BranchCode` AS `branchCode`,`g`.`BreedGroupId` AS `breedGroupId`,`g`.`BreedTypeId` AS `breedTypeId`,`p`.`Target` AS `target` from ((((((((`plant` `p` join `plantdetail` `d` on(((`d`.`PlantId` = `p`.`PlantId`) and (`p`.`CreateDate` = (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`g`.`BreedGroupId` = `d`.`BreedGroupId`))) left join `farmergroup` `fg` on((`p`.`FarmerGroupId` = `fg`.`FarmerGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `l`.`ProvinceNo`))) where (`p`.`Flag` <> 'D')
;


CREATE VIEW `r103_1` AS select `b`.`BranchName` AS `branchName`,`l`.`PublicMarketDate` AS `publicMarketDate`,`g`.`BreedGroupName` AS `breedGroupName`,`fg`.`FarmerGroupName` AS `farmerGroupName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`l`.`PlantDate` AS `plantDate`,`l`.`PlantRai` AS `plantRai`,`l`.`PlantNgan` AS `plantNgan`,`l`.`PlantWah` AS `plantWah`,`l`.`PublicCrop` AS `publicCrop`,`pro`.`ThaiName` AS `provinceName`,`l`.`ProvinceNo` AS `provinceNo`,`b`.`BranchCode` AS `branchCode`,`g`.`BreedGroupId` AS `breedGroupId`,`g`.`BreedTypeId` AS `breedTypeId` from ((((((((`plant` `p` join `plantdetail` `d` on(((`d`.`PlantId` = `p`.`PlantId`) and (`p`.`CreateDate` = (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`g`.`BreedGroupId` = `d`.`BreedGroupId`))) left join `farmergroup` `fg` on((`p`.`FarmerGroupId` = `fg`.`FarmerGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `l`.`ProvinceNo`))) where (`p`.`Flag` <> 'D')
;


CREATE VIEW `r104` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`bt`.`BreedTypeName` AS `breedTypeName`,`l`.`PlantDate` AS `plantDate`,`h`.`HarvestDate` AS `HarvestDate`,`l`.`PlantRai` AS `plantRai`,`l`.`PlantNgan` AS `plantNgan`,`l`.`PlantWah` AS `plantWah`,`l`.`ForecastRecord` AS `forecastRecord`,((`h`.`TotalHarvest` / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * truncate((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4)),0)) AS `totalHarvest`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedtype` `bt` on((`d`.`BreedTypeId` = `bt`.`BreedTypeId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `harvestdetail` `h` on(((`p`.`PlantId` = `h`.`PlantId`) and (`l`.`BreedTypeId` = `h`.`BreedTypeId`) and (`l`.`BreedGroupId` = `h`.`BreedGroupId`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d')))
;


CREATE VIEW `r104_1` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`bg`.`BreedGroupName` AS `breedGroupName`,`l`.`PlantDate` AS `plantDate`,`h`.`HarvestDate` AS `HarvestDate`,`l`.`PlantRai` AS `plantRai`,`l`.`PlantNgan` AS `plantNgan`,`l`.`PlantWah` AS `plantWah`,`l`.`ForecastRecord` AS `forecastRecord`,((`h`.`TotalHarvest` / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * truncate((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4)),0)) AS `totalHarvest`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`bg`.`BreedGroupId` AS `breedGroupId`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `bg` on((`d`.`BreedGroupId` = `bg`.`BreedGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `harvestdetail` `h` on(((`p`.`PlantId` = `h`.`PlantId`) and (`l`.`BreedTypeId` = `h`.`BreedTypeId`) and (`l`.`BreedGroupId` = `h`.`BreedGroupId`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d')))
;


CREATE VIEW `r104_2` AS select `b`.`BranchName` AS `branchName`,`fg`.`FarmerGroupName` AS `farmerGroupName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`g`.`BreedGroupName` AS `breedGroupName`,`l`.`PlantDate` AS `plantDate`,`h`.`HarvestDate` AS `HarvestDate`,`l`.`PlantRai` AS `plantRai`,`l`.`PlantNgan` AS `plantNgan`,`l`.`PlantWah` AS `plantWah`,`l`.`ForecastRecord` AS `forecastRecord`,((`h`.`TotalHarvest` / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * truncate((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4)),0)) AS `totalHarvest`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,`d`.`BreedTypeId` AS `breedTypeId`,`d`.`BreedGroupId` AS `breedGroupId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from (((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `farmergroup` `fg` on((`p`.`FarmerGroupId` = `fg`.`FarmerGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `harvestdetail` `h` on(((`p`.`PlantId` = `h`.`PlantId`) and (`l`.`BreedTypeId` = `h`.`BreedTypeId`) and (`l`.`BreedGroupId` = `h`.`BreedGroupId`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d')))
;


CREATE VIEW `r104_3` AS select `b`.`BranchName` AS `branchName`,`fg`.`FarmerGroupName` AS `farmerGroupName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`g`.`BreedGroupName` AS `breedGroupName`,`l`.`PlantDate` AS `plantDate`,`h`.`HarvestDate` AS `HarvestDate`,`l`.`PlantRai` AS `plantRai`,`l`.`PlantNgan` AS `plantNgan`,`l`.`PlantWah` AS `plantWah`,`l`.`ForecastRecord` AS `forecastRecord`,((`h`.`TotalHarvest` / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * truncate((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4)),0)) AS `totalHarvest`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,`d`.`BreedTypeId` AS `breedTypeId`,`d`.`BreedGroupId` AS `breedGroupId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`dis`.`ThaiName` AS `districtName`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `farmergroup` `fg` on((`p`.`FarmerGroupId` = `fg`.`FarmerGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `harvestdetail` `h` on(((`p`.`PlantId` = `h`.`PlantId`) and (`l`.`BreedTypeId` = `h`.`BreedTypeId`) and (`l`.`BreedGroupId` = `h`.`BreedGroupId`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `district` `dis` on((`dis`.`DistrictNo` = `l`.`DistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d')))
;


CREATE VIEW `r105` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`bt`.`BreedTypeName` AS `breedTypeName`,`p`.`IdCard` AS `countFarmer`,sum(`l`.`PlantRai`) AS `plantRai`,sum(`l`.`PlantNgan`) AS `plantNgan`,sum(`l`.`PlantWah`) AS `plantWah`,sum(`l`.`ForecastRecord`) AS `forecastRecord`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,`p`.`BreedTypeId` AS `BreedTypeId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,((`h`.`TotalHarvest` / (select sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * (`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4))) AS `totalHarvest`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from (((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedtype` `bt` on((`d`.`BreedTypeId` = `bt`.`BreedTypeId`))) left join `harvestdetail` `h` on(((`p`.`PlantId` = `h`.`PlantId`) and (`l`.`BreedTypeId` = `h`.`BreedTypeId`) and (`l`.`BreedGroupId` = `h`.`BreedGroupId`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d'))) group by `p`.`PlantId`,`l`.`ProvinceNo`,`l`.`SubDistrictNo`,`l`.`BreedGroupId`
;

CREATE VIEW `r105_1` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`bt`.`BreedTypeName` AS `breedTypeName`,`bg`.`BreedGroupName` AS `breedGroupName`,`p`.`IdCard` AS `countFarmer`,sum(`l`.`PlantRai`) AS `plantRai`,sum(`l`.`PlantNgan`) AS `plantNgan`,sum(`l`.`PlantWah`) AS `plantWah`,sum(`l`.`ForecastRecord`) AS `forecastRecord`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,`p`.`BreedTypeId` AS `BreedTypeId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,((`h`.`TotalHarvest` / (select sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * (`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4))) AS `totalHarvest`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedtype` `bt` on((`d`.`BreedTypeId` = `bt`.`BreedTypeId`))) left join `breedgroup` `bg` on((`d`.`BreedGroupId` = `bg`.`BreedGroupId`))) left join `harvestdetail` `h` on(((`p`.`PlantId` = `h`.`PlantId`) and (`l`.`BreedTypeId` = `h`.`BreedTypeId`) and (`l`.`BreedGroupId` = `h`.`BreedGroupId`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d'))) group by `p`.`PlantId`,`l`.`ProvinceNo`,`l`.`SubDistrictNo`,`bg`.`BreedGroupId`
;

CREATE VIEW `r106` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`g`.`BreedGroupName` AS `breedGroupName`,sum(`l`.`PlantRai`) AS `plantRai`,sum(`l`.`PlantNgan`) AS `plantNgan`,sum(`l`.`PlantWah`) AS `plantWah`,sum(`l`.`ForecastRecord`) AS `forecastRecord`,((`h`.`TotalHarvest` / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * truncate((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4)),0)) AS `totalHarvest`,((select (case when isnull(sum(`c`.`Amount`)) then 0 else sum(`c`.`Amount`) end) from `costdetail` `c` where ((`c`.`PlantId` = `d`.`PlantId`) and (`c`.`BreedTypeId` = `d`.`BreedTypeId`) and (`c`.`BreedGroupId` = `d`.`BreedGroupId`))) + (select (case when isnull(`ad`.`Amount`) then 0 else sum(((((((`ad`.`Amount` / 3) / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `p`.`PlantId`) and (`lr`.`BreedTypeId` = `p`.`BreedTypeId`)))) * truncate(sum((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4))),0)) / (select count(distinct `plant`.`PlantNo`) from `plant` where ((`plant`.`IdCard` = `p`.`IdCard`) and (`plant`.`Flag` <> 'D') and (`plant`.`BreedTypeId` = `p`.`BreedTypeId`) and (`plant`.`PlantYear` = `p`.`PlantYear`)))) / 365) * (case when (year(`ad`.`AssetDate`) = year(`reportDate`())) then (to_days(`reportDate`()) - to_days(`ad`.`AssetDate`)) when (dayofyear(`reportDate`()) <= 365) then dayofyear(`reportDate`()) else 365 end))) end) from `assetdetail` `ad` where ((`ad`.`AssetDate` <= `reportDate`()) and (`reportDate`() <= (`ad`.`AssetDate` + interval 3 year)) and (`ad`.`PlantId` = `d`.`PlantId`)))) AS `sumCost`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,`d`.`BreedTypeId` AS `breedTypeId`,`d`.`BreedGroupId` AS `breedGroupId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `harvestdetail` `h` on(((`p`.`PlantId` = `h`.`PlantId`) and (`l`.`BreedTypeId` = `h`.`BreedTypeId`) and (`l`.`BreedGroupId` = `h`.`BreedGroupId`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d'))) group by `f`.`IdCard`,`b`.`BranchCode`,`p`.`PlantYear`,`p`.`PlantNo`,`d`.`BreedTypeId`,`d`.`BreedGroupId`,`l`.`ProvinceNo`,`l`.`SubDistrictNo`,`p`.`PlantId`
;

CREATE VIEW `r107` AS select `b`.`BranchName` AS `branchName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`g`.`BreedGroupName` AS `breedGroupName`,sum(`l`.`PlantRai`) AS `plantRai`,sum(`l`.`PlantNgan`) AS `plantNgan`,sum(`l`.`PlantWah`) AS `plantWah`,((select (case when isnull(sum(`c`.`Amount`)) then 0 else sum(`c`.`Amount`) end) from `costdetail` `c` where ((`c`.`PlantId` = `d`.`PlantId`) and (`c`.`BreedTypeId` = `d`.`BreedTypeId`) and (`c`.`BreedGroupId` = `d`.`BreedGroupId`))) + (select (case when isnull(`ad`.`Amount`) then 0 else sum(((((((`ad`.`Amount` / 3) / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `p`.`PlantId`) and (`lr`.`BreedTypeId` = `p`.`BreedTypeId`)))) * truncate(sum((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4))),0)) / (select count(distinct `plant`.`PlantNo`) from `plant` where ((`plant`.`IdCard` = `p`.`IdCard`) and (`plant`.`Flag` <> 'D') and (`plant`.`BreedTypeId` = `p`.`BreedTypeId`) and (`plant`.`PlantYear` = `p`.`PlantYear`)))) / 365) * (case when (year(`ad`.`AssetDate`) = year(`reportDate`())) then (to_days(`reportDate`()) - to_days(`ad`.`AssetDate`)) when (dayofyear(`reportDate`()) <= 365) then dayofyear(`reportDate`()) else 365 end))) end) from `assetdetail` `ad` where ((`ad`.`AssetDate` <= `reportDate`()) and (`reportDate`() <= (`ad`.`AssetDate` + interval 3 year)) and (`ad`.`PlantId` = `d`.`PlantId`)))) AS `sumCost`,(select (case when isnull((sum(`s`.`Amount`) / sum(`s`.`SaleCrop`))) then 0 else (sum(`s`.`Amount`) / sum(`s`.`SaleCrop`)) end) from `sellingdetail` `s` where ((`h`.`PlantId` = `s`.`PlantId`) and (`h`.`BreedTypeId` = `s`.`BreedTypeId`) and (`h`.`BreedGroupId` = `s`.`BreedGroupId`) and (`h`.`HarvestDate` = `s`.`HarvestDate`))) AS `salePrice`,((`h`.`TotalHarvest` / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * truncate((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4)),0)) AS `totalHarvest`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,`d`.`BreedTypeId` AS `breedTypeId`,`d`.`BreedGroupId` AS `breedGroupId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `harvestdetail` `h` on(((`h`.`PlantId` = `d`.`PlantId`) and (`h`.`BreedTypeId` = `d`.`BreedTypeId`) and (`h`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d'))) group by `f`.`IdCard`,`b`.`BranchCode`,`p`.`PlantYear`,`p`.`PlantNo`,`d`.`BreedTypeId`,`d`.`BreedGroupId`,`l`.`ProvinceNo`,`l`.`SubDistrictNo`,`p`.`PlantId`
;


CREATE VIEW `r108_1` AS select `b`.`BranchName` AS `branchName`,`fg`.`FarmerGroupName` AS `farmerGroupName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`g`.`BreedGroupName` AS `breedGroupName`,sum(`l`.`PlantRai`) AS `plantRai`,sum(`l`.`PlantNgan`) AS `plantNgan`,sum(`l`.`PlantWah`) AS `plantWah`,sum(`l`.`ForecastRecord`) AS `forecastRecord`,((`h`.`TotalHarvest` / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * truncate((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4)),0)) AS `totalHarvest`,((select (case when isnull(sum(`c`.`Amount`)) then 0 else sum(`c`.`Amount`) end) from `costdetail` `c` where ((`c`.`PlantId` = `d`.`PlantId`) and (`c`.`BreedTypeId` = `d`.`BreedTypeId`) and (`c`.`BreedGroupId` = `d`.`BreedGroupId`))) + (select (case when isnull(`ad`.`Amount`) then 0 else sum(((((((`ad`.`Amount` / 3) / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `p`.`PlantId`) and (`lr`.`BreedTypeId` = `p`.`BreedTypeId`)))) * truncate(sum((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4))),0)) / (select count(distinct `plant`.`PlantNo`) from `plant` where ((`plant`.`IdCard` = `p`.`IdCard`) and (`plant`.`Flag` <> 'D') and (`plant`.`BreedTypeId` = `p`.`BreedTypeId`) and (`plant`.`PlantYear` = `p`.`PlantYear`)))) / 365) * (case when (year(`ad`.`AssetDate`) = year(`reportDate`())) then (to_days(`reportDate`()) - to_days(`ad`.`AssetDate`)) when (dayofyear(`reportDate`()) <= 365) then dayofyear(`reportDate`()) else 365 end))) end) from `assetdetail` `ad` where ((`ad`.`AssetDate` <= `reportDate`()) and (`reportDate`() <= (`ad`.`AssetDate` + interval 3 year)) and (`ad`.`PlantId` = `d`.`PlantId`)))) AS `sumCost`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,`d`.`BreedTypeId` AS `breedTypeId`,`d`.`BreedGroupId` AS `breedGroupId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`dis`.`ThaiName` AS `districtName`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `farmergroup` `fg` on((`p`.`FarmerGroupId` = `fg`.`FarmerGroupId`))) left join `harvestdetail` `h` on(((`p`.`PlantId` = `h`.`PlantId`) and (`l`.`BreedTypeId` = `h`.`BreedTypeId`) and (`l`.`BreedGroupId` = `h`.`BreedGroupId`)))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `district` `dis` on((`dis`.`DistrictNo` = `l`.`DistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d'))) group by `f`.`IdCard`,`b`.`BranchCode`,`p`.`PlantYear`,`p`.`PlantNo`,`d`.`BreedTypeId`,`d`.`BreedGroupId`,`l`.`ProvinceNo`,`l`.`SubDistrictNo`,`p`.`PlantId`
;


CREATE VIEW `r109_1` AS select `b`.`BranchName` AS `branchName`,`fg`.`FarmerGroupName` AS `farmerGroupName`,`sub`.`ThaiName` AS `subDistrictName`,`f`.`IdCard` AS `idCard`,`f`.`AbbrPrefix` AS `abbrPrefix`,`f`.`FirstName` AS `firstName`,`f`.`LastName` AS `lastName`,`g`.`BreedGroupName` AS `breedGroupName`,sum(`l`.`PlantRai`) AS `plantRai`,sum(`l`.`PlantNgan`) AS `plantNgan`,sum(`l`.`PlantWah`) AS `plantWah`,((select (case when isnull(sum(`c`.`Amount`)) then 0 else sum(`c`.`Amount`) end) from `costdetail` `c` where ((`c`.`PlantId` = `d`.`PlantId`) and (`c`.`BreedTypeId` = `d`.`BreedTypeId`) and (`c`.`BreedGroupId` = `d`.`BreedGroupId`))) + (select (case when isnull(`ad`.`Amount`) then 0 else sum(((((((`ad`.`Amount` / 3) / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `p`.`PlantId`) and (`lr`.`BreedTypeId` = `p`.`BreedTypeId`)))) * truncate(sum((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4))),0)) / (select count(distinct `plant`.`PlantNo`) from `plant` where ((`plant`.`IdCard` = `p`.`IdCard`) and (`plant`.`Flag` <> 'D') and (`plant`.`BreedTypeId` = `p`.`BreedTypeId`) and (`plant`.`PlantYear` = `p`.`PlantYear`)))) / 365) * (case when (year(`ad`.`AssetDate`) = year(`reportDate`())) then (to_days(`reportDate`()) - to_days(`ad`.`AssetDate`)) when (dayofyear(`reportDate`()) <= 365) then dayofyear(`reportDate`()) else 365 end))) end) from `assetdetail` `ad` where ((`ad`.`AssetDate` <= `reportDate`()) and (`reportDate`() <= (`ad`.`AssetDate` + interval 3 year)) and (`ad`.`PlantId` = `d`.`PlantId`)))) AS `sumCost`,(select (case when isnull((sum(`s`.`Amount`) / sum(`s`.`SaleCrop`))) then 0 else (sum(`s`.`Amount`) / sum(`s`.`SaleCrop`)) end) from `sellingdetail` `s` where ((`h`.`PlantId` = `s`.`PlantId`) and (`h`.`BreedTypeId` = `s`.`BreedTypeId`) and (`h`.`BreedGroupId` = `s`.`BreedGroupId`) and (`h`.`HarvestDate` = `s`.`HarvestDate`))) AS `salePrice`,((`h`.`TotalHarvest` / (select truncate(sum((`lr`.`PlantRai` + ((`lr`.`PlantNgan` + (`lr`.`PlantWah` / 100)) / 4))),0) from `landright` `lr` where ((`lr`.`PlantId` = `d`.`PlantId`) and (`lr`.`BreedTypeId` = `d`.`BreedTypeId`) and (`lr`.`BreedGroupId` = `d`.`BreedGroupId`)))) * truncate((`l`.`PlantRai` + ((`l`.`PlantNgan` + (`l`.`PlantWah` / 100)) / 4)),0)) AS `totalHarvest`,`pro`.`ThaiName` AS `provinceName`,`b`.`BranchCode` AS `branchCode`,`p`.`PlantYear` AS `plantYear`,`p`.`PlantNo` AS `plantNo`,`pro`.`ProvinceNo` AS `provinceNo`,`d`.`BreedTypeId` AS `breedTypeId`,`d`.`BreedGroupId` AS `breedGroupId`,(cast(`p`.`CreateDate` as date) + interval 543 year) AS `effectiveDate`,`dis`.`ThaiName` AS `districtName`,`p`.`PlantId` AS `plantId`,`p`.`RefPlantId` AS `refplantid` from ((((((((((`plant` `p` join `plantdetail` `d` on((`d`.`PlantId` = (select max(`plant`.`PlantId`) from `plant` where ((`plant`.`RefPlantId` = `p`.`RefPlantId`) and (`plant`.`Flag` <> 'D')))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `harvestdetail` `h` on(((`h`.`PlantId` = `d`.`PlantId`) and (`h`.`BreedTypeId` = `d`.`BreedTypeId`) and (`h`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `farmer` `f` on(((`p`.`IdCard` = `f`.`IdCard`) and (`p`.`EffectiveDate` = `f`.`EffectiveDate`)))) left join `farmergroup` `fg` on((`p`.`FarmerGroupId` = `fg`.`FarmerGroupId`))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `district` `dis` on((`dis`.`DistrictNo` = `l`.`DistrictNo`))) left join `branch` `b` on((`p`.`BranchCode` = `b`.`BranchCode`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `b`.`ProvinceNo`))) where ((`p`.`Flag` <> 'D') and `p`.`CreateDate` in (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`,date_format(`pl`.`CreateDate`,'%Y%m%d'))) group by `f`.`IdCard`,`b`.`BranchCode`,`p`.`PlantYear`,`p`.`PlantNo`,`d`.`BreedTypeId`,`d`.`BreedGroupId`,`l`.`ProvinceNo`,`l`.`SubDistrictNo`,`p`.`PlantId`
;


CREATE VIEW `r110` AS select `l`.`ForecastDate` AS `forecastDate`,`t`.`BreedTypeName` AS `breedTypeName`,`g`.`BreedGroupName` AS `breedGroupName`,`l`.`ForecastRecord` AS `forecastRecord`,`reg`.`RegionName` AS `regionName`,`pro`.`ThaiName` AS `provinceName`,`dis`.`ThaiName` AS `districtName`,`sub`.`ThaiName` AS `subDistrictName`,`reg`.`RegionNo` AS `regionNo`,`g`.`BreedGroupId` AS `breedGroupId`,`g`.`BreedTypeId` AS `breedTypeId`,`p`.`BranchCode` AS `branchCode` from ((((((((`plant` `p` join `plantdetail` `d` on(((`d`.`PlantId` = `p`.`PlantId`) and (`p`.`CreateDate` = (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedtype` `t` on((`d`.`BreedTypeId` = `t`.`BreedTypeId`))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `district` `dis` on((`dis`.`DistrictNo` = `l`.`DistrictNo`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `l`.`ProvinceNo`))) left join `region` `reg` on((`reg`.`RegionNo` = `l`.`RegionNo`))) where (`p`.`Flag` <> 'D')
;


CREATE VIEW `r110_1` AS select `l`.`PublicMarketDate` AS `publicMarketDate`,`t`.`BreedTypeName` AS `breedTypeName`,`g`.`BreedGroupName` AS `breedGroupName`,`l`.`PublicCrop` AS `publicCrop`,`reg`.`RegionName` AS `regionName`,`pro`.`ThaiName` AS `provinceName`,`dis`.`ThaiName` AS `districtName`,`sub`.`ThaiName` AS `subDistrictName`,`reg`.`RegionNo` AS `regionNo`,`g`.`BreedGroupId` AS `breedGroupId`,`g`.`BreedTypeId` AS `breedTypeId`,`p`.`BranchCode` AS `branchCode` from ((((((((`plant` `p` join `plantdetail` `d` on(((`d`.`PlantId` = `p`.`PlantId`) and (`p`.`CreateDate` = (select max(`pl`.`CreateDate`) from `plant` `pl` where (`pl`.`RefPlantId` = `p`.`RefPlantId`) group by `pl`.`RefPlantId`))))) join `landright` `l` on(((`l`.`PlantId` = `d`.`PlantId`) and (`l`.`BreedTypeId` = `d`.`BreedTypeId`) and (`l`.`BreedGroupId` = `d`.`BreedGroupId`)))) left join `breedtype` `t` on((`d`.`BreedTypeId` = `t`.`BreedTypeId`))) left join `breedgroup` `g` on((`d`.`BreedGroupId` = `g`.`BreedGroupId`))) left join `subdistrict` `sub` on((`sub`.`SubDistrictNo` = `l`.`SubDistrictNo`))) left join `district` `dis` on((`dis`.`DistrictNo` = `l`.`DistrictNo`))) left join `province` `pro` on((`pro`.`ProvinceNo` = `l`.`ProvinceNo`))) left join `region` `reg` on((`reg`.`RegionNo` = `l`.`RegionNo`))) where (`p`.`Flag` <> 'D')
;













































